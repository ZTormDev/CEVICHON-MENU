const productos = [

    // CEVICHES CAMARON O SALMON O MACHA  
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$4.500',
      precioActual: '$3.500',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/cevich.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.000',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$11.500',
      precioActual: '$10.500',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },


    // CEVICHES CAMARON Y SALMON
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-salmoncamaron.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.000',
      precioActual: '$4.000',
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/ceviche500g-camaronsalmon.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.500',
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche1kg-camaronsalmon.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$13.000',
      precioActual: '$12.000',
      cantidad: '1'
    },


    // CEVICHES MACHA SALMON O MACHA CAMARON
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-machasalmonomachacamaron.png',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.000',
      precioActual: '$4.000',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/cevic.jpg',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.500',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/cevich.png',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$13.000',
      precioActual: '$12.000',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },


    // CEVICHES SALMON CAMARON Y MACHA || TRILOGIA MARINA
    {
      nombre: 'Trilogia Marina',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-trilogiamarina.png',
      descripcionCorta: 'Salmon, Camaron y Macha',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.500',
      precioActual: '$4.500',
      cantidad: '1'
    },
    {
      nombre: 'Trilogia Marina',
        tamaño: '500g', 
        imagen: '/ceviches/ceviche500g-trilogiamarina.png',
        descripcionCorta: 'Salmon, Camaron y Macha',
        descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
        precioAnterior: '$8.500',
        precioActual: '$7.500',
        cantidad: '1'
    },
    {
      nombre: 'Trilogia Marina',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche1kg-trilogiamarina.png',
      descripcionCorta: 'Salmon, Camaron y Macha',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$14.000',
      precioActual: '$13.000',
      cantidad: '1'
    },



    // AGREGADOSSSSS
    {
      nombre: 'Tostadas',
      tamaño: '3 uds', 
      imagen: '/agregados/tostadas.png',
      descripcionCorta: 'Tostadas de oregano y mantequilla',
      descripcion: 'Tostaditas cubiertas con mantequilla y un liguero toque de oregano lo cual es conveniente con un buen ceviche.',
      precioAnterior: '$2.000',
      precioActual: '$1.000',
      cantidad: '1'
    },
    {
      nombre: 'Salsa de Cilantro',
      tamaño: '1 uds', 
      imagen: '/agregados/salsadeajo.png',
      descripcionCorta: 'Deliciosa lactonesa echa a base leche..',
      descripcion: 'Deliciosa lactonesa echa a base leche, ajo, aceite, limón, sal y cilantro, acompañado de la magia de la casa.',
      precioAnterior: '$1.000',
      precioActual: '$500',
      cantidad: '1'
    },
];



const ItemPreviewContainer = document.getElementById('product-preview-container');
const ItemPreview = document.getElementById('product-preview');

const productPreviewTitle = document.querySelector('.product-preview-title');
const productPreviewImage = document.querySelector('.product-preview-image');
const productPreviewDetails = document.querySelector('.product-preview-details');
const productPreviewPriceAnterior = document.querySelector('.product-preview-price-anterior');
const productPreviewPrice = document.querySelector('.product-preview-price');
const productPreviewPedirButton = document.querySelector('.pedir-button');

const seleccionContainer = document.querySelector('.seleccion-container');
const seleccionButtons = document.querySelector('.seleccion-buttons');

const cantidadText = document.querySelector('.cantidad');
const sumarButton = document.querySelector('.sumar');
const restarButton = document.querySelector('.restar');

function generarProductos() {
    const productosContainer = document.querySelector('.productos-container');
  
    productos.forEach((producto, index) => {
      const article = document.createElement('article');
      article.onclick = () => mostrarDetalleProducto(producto);

      article.id = `producto-${index + 1}`;
  
      article.innerHTML = `
        <div class='image-container'>
            <img class='imagenProducto' src="./assets/${producto.imagen}" alt="${producto.nombre}" />
        </div>
        <div class='product-details'>
            <div class="text-details">
                <h2 class='nombreProducto'>${producto.nombre} <p class="tamaño-ceviche">${producto.tamaño}</p></h2>
                <p>${producto.descripcionCorta}</p>
            </div>
            <div class='precio-container'>
                <p class="precio-anterior">${producto.precioAnterior}</p>
                <p class='precioProducto'>${producto.precioActual}</p>
            </div>
        </div>
      `;
  
      productosContainer.appendChild(article);
    });
  }

  // Función para aumentar la cantidad
  function sumar(producto) {
    let cantidad = parseInt(cantidadText.innerHTML);
    cantidad++;
    cantidadText.innerHTML = cantidad;
    // Actualizar la cantidad en el objeto de producto
    producto.cantidad = cantidad.toString();
    // Actualizar el enlace del botón "Pedir" con la nueva cantidad
    actualizarEnlacePedir(producto);
  }

  // Función para disminuir la cantidad
  function restar(producto) {
    let cantidad = parseInt(cantidadText.innerHTML);
    if (cantidad > 1) {
        cantidad--;
        cantidadText.innerHTML = cantidad;
        // Actualizar la cantidad en el objeto de producto
        producto.cantidad = cantidad.toString();
        // Actualizar el enlace del botón "Pedir" con la nueva cantidad
        actualizarEnlacePedir(producto);
    }
  }

  // Función para actualizar el enlace del botón "Pedir" con la cantidad seleccionada
  function actualizarEnlacePedir(producto) {
    const datosGuardados = localStorage.getItem('datosCliente');
    const datos = JSON.parse(datosGuardados);

    let cantidad = parseInt(cantidadText.innerHTML);

    let precioProducto = producto.precioActual.replace(/\./g, '').replace('$', '');

    let total = precioProducto * cantidad;
    let precioTotalConPuntos = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');

    let mensajeCantidad = producto.seleccion === 'si' ? `Seleccion: *${seleccionButtons.querySelector('.active').textContent}*, ` : ``;

    if (datosGuardados) {
      
      productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}* *${producto.tamaño}*%0ACantidad: *${cantidad}*, ${mensajeCantidad}%0ATotal: *$${precioTotalConPuntos}*%0A%0AMi datos son:%0ANombre: ${datos.nombre}%0ATelefono: ${datos.telefono}%0ADireccion: ${datos.direccion}%0AComuna: ${datos.comuna}%0AReferencias: ${datos.referencia}`);
    }
    else {
      productPreviewPedirButton.removeAttribute('href');
      productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');
    }
  }

  const alertaPedirContainer = document.querySelector('.alerta-pedir-container');

  function mostrarAlertaPedir() {
    alertaPedirContainer.style.display = 'flex';
    ItemPreviewContainer.classList.add('hidden');
  }

  function ocultarAlertaPedir() {
    alertaPedirContainer.style.display = 'none';
  }

  function mostrarIngresarDatos() {
    alertaPedirContainer.style.display = 'none';
    datosBG.style.display = 'flex';
  }

  function mostrarDetalleProducto(producto) {
    productPreviewTitle.innerHTML = `${producto.nombre} <p class="preview-tamaño-ceviche">${producto.tamaño}</p>`;
    productPreviewImage.src = `./assets/${producto.imagen}`;
    productPreviewDetails.innerHTML = producto.descripcion;
    productPreviewPriceAnterior.innerHTML = producto.precioAnterior;
    productPreviewPrice.innerHTML = producto.precioActual;

    const datosGuardados = localStorage.getItem('datosCliente');
    productPreviewPedirButton.removeAttribute('href');
    productPreviewPedirButton.removeAttribute('onclick');

    if (datosGuardados) { 
      //AQUI ACTUALIZAR EL LINKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
      const datosGuardados = localStorage.getItem('datosCliente');
      const datos = JSON.parse(datosGuardados);
      productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}* *${producto.tamaño}*%0ACantidad: *${cantidadText.innerHTML}*%0ATotal: *${producto.precioActual}*%0A%0AMi datos son:%0ANombre: ${datos.nombre}%0ATelefono: ${datos.telefono}%0ADireccion: ${datos.direccion}%0AComuna: ${datos.comuna}%0AReferencias: ${datos.referencia}`);
    } 
    else {
      productPreviewPedirButton.removeAttribute('href');
      if(producto.seleccion != 'si') {
        productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');
      }
    }
    


    cantidadText.innerHTML = `${producto.cantidad}`;
    sumarButton.onclick = () => sumar(producto);
    restarButton.onclick = () => restar(producto);

    ItemPreviewContainer.classList.remove('hidden');
    ItemPreview.classList.add('enterAnimation');


    if(producto.seleccion == 'si') {
      const datosGuardados = localStorage.getItem('datosCliente');
      const datos = JSON.parse(datosGuardados);

      seleccionContainer.classList.remove('hidden')

      // Limpiamos el contenedor antes de agregar nuevos botones
      seleccionButtons.innerHTML = '';

      productPreviewPedirButton.classList.add('disabled');
      productPreviewPedirButton.removeAttribute('href');

      producto.tipoSeleccion.forEach(tipo => {
        const button = document.createElement('button');
        button.classList.add('seleccion-button');
        button.textContent = tipo;
        button.onclick = () => {
            // Iterar sobre todos los botones dentro de seleccionButtons
            seleccionButtons.querySelectorAll('button').forEach(btn => {
                // Eliminar la clase 'active' de cada botón
                btn.classList.remove('active');
            });
            // Agregar la clase 'active' al botón actual
            button.classList.add('active');
            // Actualizar el enlace del botón "Pedir" con la nueva selección
            productPreviewPedirButton.classList.remove('disabled');

            if (datosGuardados) {
              let cantidad = parseInt(cantidadText.innerHTML);
              let precioProducto = producto.precioActual.replace(/\./g, '').replace('$', '');
              let total = precioProducto * cantidad;
              let precioTotalConPuntos = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');

              productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}* *${producto.tamaño}*%0ASeleccion: *${tipo}*%0ACantidad: *${cantidadText.innerHTML}*%0ATotal: *$${precioTotalConPuntos}*%0A%0AMi datos son:%0ANombre: ${datos.nombre}%0ATelefono: ${datos.telefono}%0ADireccion: ${datos.direccion}%0AComuna: ${datos.comuna}%0AReferencias: ${datos.referencia}`);
            }
            else {
              productPreviewPedirButton.removeAttribute('href');
              productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');
            }
            
        };
        seleccionButtons.appendChild(button);
    });
    }
    else {
      seleccionContainer.classList.add('hidden')
    }

  }

  function closeItemPreview() {
    ItemPreviewContainer.classList.add('hidden');
    ItemPreview.classList.remove('enterAnimation')
  }


  const datosBG = document.querySelector('.datos-container-bg');

  function mostrarDatos() {
    datosBG.style.display = 'flex';
  }

  function ocultarDatos() {
    datosBG.style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', function() {
    const nombreInput = document.querySelector('input[name="nombre"]');
    const telefonoInput = document.querySelector('input[name="telefono"]');
    const direccionInput = document.querySelector('input[name="direccion"]');
    const comunaInput = document.querySelector('input[name="comuna"]');
    const numeroInput = document.querySelector('input[name="referencia"]');
    const placeholdenButtonConfirmar = document.querySelector('.confirmar-placeholder');
    const confirmarButton = document.getElementById('confirmar-button');
    const regexNumeros = /^\+?[0-9]+$/;


    function guardarDatosLocalStorage() {
      const datos = {
          nombre: nombreInput.value.trim(),
          telefono: telefonoInput.value.trim(),
          direccion: direccionInput.value.trim(),
          comuna: comunaInput.value.trim(),
          referencia: numeroInput.value.trim()
      };
      localStorage.setItem('datosCliente', JSON.stringify(datos));
  }

  function cargarDatosLocalStorage() {
      const datosGuardados = localStorage.getItem('datosCliente');
      if (datosGuardados) {
          const datos = JSON.parse(datosGuardados);
          nombreInput.value = datos.nombre;
          telefonoInput.value = datos.telefono;
          direccionInput.value = datos.direccion;
          comunaInput.value = datos.comuna;
          numeroInput.value = datos.referencia;
          actualizarEstiloConfirmar();
      }
  }

    // Función para verificar si todos los campos están completos
    function verificarDatosCompletos() {
        return (
            nombreInput.value.trim().toLowerCase() !== '' &&
            regexNumeros.test(telefonoInput.value.trim().toLowerCase()) &&
            telefonoInput.value.trim().toLowerCase().length >= 9 &&
            telefonoInput.value.trim().toLowerCase().length <= 12 &&
            direccionInput.value.trim().toLowerCase() !== '' &&
            numeroInput.value.trim().toLowerCase() !== '' &&
            comunaInput.value.trim().toLowerCase() === 'concepcion' || comunaInput.value.trim().toLowerCase() === 'concepción'
            
        );
    }
    const inputComuna = document.querySelector('input[name="comuna"]');
    const inputTelefono = document.querySelector('input[name="telefono"]');
    const alertaComuna = document.querySelector('.alerta-comuna');
    const alertaTelefono = document.querySelector('.alerta-telefono');
  
    inputComuna.addEventListener('input', function() {
      const comunaValue = inputComuna.value.trim().toLowerCase();
  
      if (comunaValue !== 'concepcion' && comunaValue !== 'concepción') {
        alertaComuna.classList.remove('hidden');
      } else {
        alertaComuna.classList.add('hidden');
      }
  });

  inputTelefono.addEventListener('input', function() {
    const telefonoValue = inputTelefono.value.trim().toLowerCase();

    if (telefonoValue.length >= 9 && telefonoValue.length <= 12 && regexNumeros.test(telefonoValue)) {
      alertaTelefono.classList.add('hidden');
    } else {
      alertaTelefono.classList.remove('hidden');
    }
});

    
    // Función para ocultar el contenedor de fondo
    function ocultarDatosContainer() {
      datosBG.style.display = 'none';
      guardarDatosLocalStorage();
    }

  // Función para actualizar el estilo del botón "Confirmar datos"
  function actualizarEstiloConfirmar() {
      if (verificarDatosCompletos()) {
          confirmarButton.style.opacity = '1';
          confirmarButton.style.cursor = 'pointer';
          placeholdenButtonConfirmar.classList.add('hidden');
          confirmarButton.onclick = ocultarDatosContainer;
      } else {
          confirmarButton.style.opacity = '0.5'; // O cualquier otro valor de opacidad que desees
          confirmarButton.style.cursor = 'default';
          placeholdenButtonConfirmar.classList.remove('hidden');
      }
  }

    // Agregar evento input a los campos de entrada
    nombreInput.addEventListener('input', actualizarEstiloConfirmar);
    telefonoInput.addEventListener('input', actualizarEstiloConfirmar);
    direccionInput.addEventListener('input', actualizarEstiloConfirmar);
    comunaInput.addEventListener('input', actualizarEstiloConfirmar);
    numeroInput.addEventListener('input', actualizarEstiloConfirmar);

  window.onload = function() {
    cargarDatosLocalStorage();
    generarProductos(); // Esta función debería estar disponible aquí si no está declarada globalmente
};

});


